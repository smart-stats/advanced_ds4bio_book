<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.245">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advanced Data Science for Public Health - 19&nbsp; Machine learning validation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ethics.html" rel="next">
<link href="./causal.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Machine learning validation</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanced Data Science for Public Health</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/smart-stats/advanced_ds4bio_book" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Interactive graphics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webscraping.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced web scrapping</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./images.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Working with images</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databases.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Databases</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pipelines</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_structures.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data structures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diymlai.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">DIY ML/AI</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./convnet_example.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Convolutional AI</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unsupervised.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Unsupervised learning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./variationalAEs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Variational autoencoders</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nlp.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">NLP</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./measurement.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Measurement</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_analysis_theory.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data science, conceptually</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat_language.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Statistics and language</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_science_as_a_science.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Data science as an applied science</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graphics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Theory of graphical display</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Causal DAGs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validation.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Machine learning validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ethics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ethics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#basics" id="toc-basics" class="nav-link active" data-scroll-target="#basics"><span class="toc-section-number">20</span>  Basics</a>
  <ul class="collapse">
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="toc-section-number">20.0.1</span>  Example</a></li>
  <li><a href="#roc-curves" id="toc-roc-curves" class="nav-link" data-scroll-target="#roc-curves"><span class="toc-section-number">20.1</span>  ROC curves</a>
  <ul class="collapse">
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="toc-section-number">20.1.1</span>  Estimation</a></li>
  <li><a href="#binormal-estimation" id="toc-binormal-estimation" class="nav-link" data-scroll-target="#binormal-estimation"><span class="toc-section-number">20.1.2</span>  Binormal estimation</a></li>
  </ul></li>
  <li><a href="#testing-versus-training-versions" id="toc-testing-versus-training-versions" class="nav-link" data-scroll-target="#testing-versus-training-versions"><span class="toc-section-number">20.2</span>  Testing versus training versions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Machine learning validation</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="basics" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Basics</h1>
<p>Consider the following definitions for the results of a diagnostic test <span class="math inline">\(X\in \{0,1\}\)</span>, where the actual disease state is <span class="math inline">\(Y\in \{0,1\}\)</span>. Assume 1 represents having/testing for the disease.</p>
<ol type="1">
<li><strong>Sensitivity</strong> <span class="math inline">\(P(X=1 ~|~ Y=1)\)</span>, probability that the test is positive given the disease is present, also called the true positive rate. <span class="math inline">\(P(X=0 ~|~ Y=1)\)</span> (one minus the sensitivity) is the false negative rate.</li>
<li><strong>Specificity</strong> <span class="math inline">\(P(X=0 ~|~ Y=0)\)</span>, probability that the test is negative given the disease is absent, also called the true negative rate. <span class="math inline">\(P(X=1~|~ Y=0)\)</span> (one minus the specificity) is the false negative rate.</li>
<li><strong>PPV</strong>, positive predictive value <span class="math inline">\(P(Y=1 ~|~ X=1)\)</span>.</li>
<li><strong>NPV</strong>, negative predictive value <span class="math inline">\(P(Y=0 ~|~ X=0)\)</span>.</li>
<li><strong>DLR+</strong>, diagnostic likelihood ratio of a positive test <span class="math inline">\(P(X=1 ~|~ Y=1) / P(X=1 ~|~ Y= 0)\)</span> is also the sensitivity over one minus the specificity, i.e.&nbsp;the true positive rate divided by the false positive rate.</li>
<li><strong>DLR-</strong>, diagnostic likelihood ratio of a negative test <span class="math inline">\(P(X=0) ~|~ Y=1) / P(X=0 ~|~ Y=0)\)</span> is one minus the sensitivity divided by the specificity or the false negative rate divided by the true negative rate.</li>
<li>The <strong>disease prevalence</strong> is <span class="math inline">\(P(Y=1)\)</span>.</li>
</ol>
<p>In a frequency setting with a positive test, one might argue that the <span class="math inline">\(P(Y=1)\)</span> is one or zero depending on whether or not a subject has the disease thus the PPV is either one or zero respectively. However, this is not how these tests are used. Instead, think of the PPV not as the probability that <em>this</em> subject has the disease, but rather as the probability that subjects like this subject have the disease. For Bayesian interpretations, saying the probability that a subject has the disease is just fine. Either way, it’s fine to use these conditional probabilities (i.e.&nbsp;being Bayesian is more than just the use of Bayes’ rule, its using Bayesian interpretations).</p>
<p>If you have a cross-sectional sample, then all of these quatities are directly estimable. If the data were sampled by case / control status (<span class="math inline">\(Y=1\)</span> or <span class="math inline">\(Y=0\)</span>), then <span class="math inline">\(Y\)</span> is conditioned on by the design and the sensitivity, specificity and DLR+/- are directly estimable. You can obtain the PPV and NPV using Bayes’ rule given a disease prevalance. This is a standard textbook problem. Similarly, in a setting where the design fixes the test result, the NPV and PPV would be directly estimable and one would have to use the prevalance of a positive test and Bayes’ rule to obtain the sensitivity and specificity. (This sort of design is less usual.)</p>
<section id="example" class="level3" data-number="20.0.1">
<h3 data-number="20.0.1" class="anchored" data-anchor-id="example"><span class="header-section-number">20.0.1</span> Example</h3>
<p>A study comparing the efficacy of HIV tests, reports on an experiment which concluded that HIV antibody tests have a sensitivity of 99.7% and a specificity of 98.5% Suppose that a subject, from a population with a .1% prevalence of HIV, receives a positive test result. What is the positive predictive value?</p>
<p>Mathematically, we want <span class="math inline">\(P(Y=1 | X=1)\)</span> given the sensitivity, <span class="math inline">\(P(X=1 | Y=1) = .997\)</span>, the specificity, <span class="math inline">\(P(X=0 | Y=0) =0.985\)</span>$ and the prevalence <span class="math inline">\(P(Y=1) =0.001\)</span>.</p>
<p><span class="math display">\[
\begin{align*}
P(Y=1 ~|~ X=1) &amp; = \frac{P(X=1 ~|~ Y=1)P(Y=1)}{P(X=1~|~Y=1)P(Y=1) + P(X=1 ~|~ Y=0)P(Y=0)}\\
               &amp; = \frac{P(X=1|Y=1)P(Y=1)}{P(X=1|Y=1)P(Y=1) + {1-P(X=0 ~|~ Y = 0)}{1 - P(Y=1)}} \\
               &amp; = \frac{.997\times .001}{.997 \times .001 + .015 \times .999}\ = .062
\end{align*}
\]</span></p>
<p>In this population a positive test result suggests a 6% probability that the subject has the disease, (the positive predictive value is 6% for this test). If you were wondering how it could be so low for this test, the low positive predictive value is due to low prevalence of disease and the somewhat modest specificity</p>
<p>Suppose it was known that the subject was an intravenous drug user and routinely had intercourse with an HIV infected partner? Our prevalence would change dramatically, thus increasing the PPV. You might wonder if there’s a way to summarize the evidence without appealing to an often unknowable prevalence? Diagnostic likelihood ratios provide this for us.</p>
<p>We have: <span class="math display">\[
P(Y = 1 ~|~ X = 1) = \frac{P(X=1~|~ Y = 1)P(Y=1)}{P(X=1)}
\]</span></p>
<p>and</p>
<p><span class="math display">\[ P(Y=0 ~|~ X=1) = \frac{P(X=1 ~|~ Y=0)P(Y=0)}{P(X=1)}. \]</span></p>
<p>Therefore, dividing these two equations we have:</p>
<p><span class="math display">\[
\frac{P(Y = 0 ~|~ X=1)}{P(Y=1 ~|~ X=1)} = \frac{P(X = 1 ~|~ Y=1)}{P(X = 1 ~|~ Y=0)}\times \frac{P(Y=1)}{P(Y=0)}
\]</span></p>
<p>In other words, the post test odds of disease is the pretest odds of disease times the <span class="math inline">\(DLR_+\)</span>. Similarly, <span class="math inline">\(DLR_-\)</span> relates the decrease in the odds of the disease after a negative test result to the odds of disease prior to the test. So, the DLRs are the factors by which you multiply your pretest odds to get your post test odds. Thus, if a test has a <span class="math inline">\(DLR_+\)</span> of 6, regardless of the prevalence of disease, the post test odds is six times that of the pretest odds.</p>
<p>HIV example revisited Let’s reconsider our HIV antibody test again. Suppose a subject has a positive HIV test, <span class="math inline">\(DLR_+ = .997 / (1 - .985) = 66\)</span>. The result of the positive test is that the odds of disease is now 66 times the pretest odds. Or, equivalently, the hypothesis of disease is 66 times more supported by the data than the hypothesis of no disease</p>
<p>Suppose instead that a subject has a negative test result. Then <span class="math inline">\(DLR_- = (1 - .997) / .985 =.003\)</span> Therefore, the post-test odds of disease is now 0.3% of the pretest odds given the negative test. Or, the hypothesis of disease is supported $<span class="math inline">\(.003\)</span> times that of the hypothesis of absence of disease given the negative test result</p>
</section>
<section id="roc-curves" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="roc-curves"><span class="header-section-number">20.1</span> ROC curves</h2>
<p>Typically, <span class="math inline">\(X\)</span> is not binary, but rather a more continuous value. Consider trying to predict lesion status using FLAIR value using the data below.</p>
<div class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>FLAIR</th>
      <th>PD</th>
      <th>T1</th>
      <th>T2</th>
      <th>FLAIR_10</th>
      <th>PD_10</th>
      <th>T1_10</th>
      <th>T2_10</th>
      <th>FLAIR_20</th>
      <th>PD_20</th>
      <th>T1_20</th>
      <th>T2_20</th>
      <th>GOLD_Lesions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.143692</td>
      <td>1.586219</td>
      <td>-0.799859</td>
      <td>1.634467</td>
      <td>0.437568</td>
      <td>0.823800</td>
      <td>-0.002059</td>
      <td>0.573663</td>
      <td>0.279832</td>
      <td>0.548341</td>
      <td>0.219136</td>
      <td>0.298662</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.652552</td>
      <td>1.766672</td>
      <td>-1.250992</td>
      <td>0.921230</td>
      <td>0.663037</td>
      <td>0.880250</td>
      <td>-0.422060</td>
      <td>0.542597</td>
      <td>0.422182</td>
      <td>0.549711</td>
      <td>0.061573</td>
      <td>0.280972</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.036099</td>
      <td>0.262042</td>
      <td>-0.858565</td>
      <td>-0.058211</td>
      <td>-0.044280</td>
      <td>-0.308569</td>
      <td>0.014766</td>
      <td>-0.256075</td>
      <td>-0.136532</td>
      <td>-0.350905</td>
      <td>0.020673</td>
      <td>-0.259914</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.037692</td>
      <td>0.011104</td>
      <td>-1.228796</td>
      <td>-0.470222</td>
      <td>-0.013971</td>
      <td>-0.000498</td>
      <td>-0.395575</td>
      <td>-0.221900</td>
      <td>0.000807</td>
      <td>-0.003085</td>
      <td>-0.193249</td>
      <td>-0.139284</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> dat.FLAIR</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> dat.GOLD_Lesions</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> dat.FLAIR[y <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> dat.FLAIR[y <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x0, shade <span class="op">=</span> <span class="va">True</span>, label <span class="op">=</span> <span class="st">'Gold Std = 0'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x1, shade <span class="op">=</span> <span class="va">True</span>, label <span class="op">=</span> <span class="st">'Gold Std = 1'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="validation_files/figure-html/cell-3-output-1.png" width="597" height="437"></p>
</div>
</div>
<p>Consider a given FLAIR threshold, say <span class="math inline">\(c\)</span>. Then the true positive rate given that threshold is <span class="math inline">\(T(c) = P(X \geq c ~|~ Y=1)\)</span> and the false positive rate is <span class="math inline">\(F(c) = P(X \geq c~|~ Y=0 )\)</span>. Provided continuity, these are like conditional survival functions. (The statement provided continuity is needed, since survival functions are usually defined as <span class="math inline">\(&gt;\)</span> not <span class="math inline">\(\geq\)</span> which can differ otherwise). Note, given an FPR, <span class="math inline">\(f\)</span>, then the associated threshold would be <span class="math inline">\(F^{-1}(f)\)</span> and the associated TPR with that threshold would be <span class="math inline">\(T\{F^{-1}(f)\}\)</span>. The ROC curve is a plot of <span class="math inline">\((f, T\{F^{-1}(f)\})\)</span> and an empirical estimate of the ROC curve requires an estimate of <span class="math inline">\(T\)</span> and <span class="math inline">\(F\)</span>.</p>
<p>The ROC curve satisfies:</p>
<ol type="1">
<li>Starts at the point (0, 0). <span class="math inline">\(F(\infty) = 0\)</span> implies <span class="math inline">\(F^{-1}(0) = \infty\)</span> which implies <span class="math inline">\(T\{F^{-1}(0)\} = 0\)</span>.</li>
<li>Ends at the point (1, 1). <span class="math inline">\(F(-\infty) = 1\)</span> imples <span class="math inline">\(F^{-1}(1) = -\infty\)</span> which implies <span class="math inline">\(T\{F^{-1}(1) \}= 1\)</span>.</li>
<li>Is monotonic. <span class="math inline">\(f\)</span> increasing implies <span class="math inline">\(F^{-1}(f)\)</span> is non-increasing which implies <span class="math inline">\(T\{F^{-1}(f)\)</span> is non-decreasing.</li>
<li>The best possible test limits to the a discontinuous function (0, 0), (0, 1), (1, 1). This follows from 3 and that one can generate tests that limit to this.</li>
<li>If <span class="math inline">\(X \sim U[0,1] \perp Y\)</span> the ROC curve is the identity line from (0, 0) to (1, 1). This follows from <span class="math inline">\(T(c) = F(c) = 1-c\)</span> for <span class="math inline">\(c \in [0, 1]\)</span>, thus <span class="math inline">\(F^{-1}(f) = 1 - f\)</span> and hence <span class="math inline">\(T\{F^{-1}(f)\} = f\)</span>.</li>
<li>Let <span class="math inline">\(Z = g(X)\)</span> for <span class="math inline">\(g\)</span> a strictly monotonic, increasing function, <span class="math inline">\(g\)</span>. Let <span class="math inline">\(F_Z\)</span> and <span class="math inline">\(T_Z\)</span> be the associated true and false positive rates. Note then <span class="math inline">\(F_z(c) = P(X \geq g^{-1}(c) ~|~ Y = 0)=F(g^{-1}(c))\)</span>, <span class="math inline">\(T_z(c) = T(g^{-1}(c))\)</span> and then <span class="math inline">\(F^{-1}_z(f) = g\{F^{-1}(f)\}\)</span>. Then, the ROC function, <span class="math inline">\(T_z\{F^{-1}_Z(f) = T \circ g^{-1} \circ g \circ F^{-1}(f) = T\{F^{-1}(f)\}\)</span> Thus the ROC curve is invariant to these sorts of transformations.</li>
<li>Combining 5 and 6, the ROC curve is an identity line whenever <span class="math inline">\(X \perp Y\)</span> since <span class="math inline">\(g(U[0,1])\)</span> covers most distributions.</li>
<li>The ROC curve for <span class="math inline">\(X\)</span> as a test for <span class="math inline">\(\tilde Y = 1 - Y\)</span> flips the ROC curve of <span class="math inline">\(X\)</span> as a test for <span class="math inline">\(Y\)</span> over the identity line. (This simply reverses <span class="math inline">\(T\)</span> and <span class="math inline">\(F\)</span> hence the result.)</li>
</ol>
<section id="estimation" class="level3" data-number="20.1.1">
<h3 data-number="20.1.1" class="anchored" data-anchor-id="estimation"><span class="header-section-number">20.1.1</span> Estimation</h3>
<p>Thus, a natural (and consistent) estimate of <span class="math inline">\(T\)</span> is the conditional distribution function is <span class="math display">\[
\hat T(c) = \frac{\sum_{i=1}^n I(x_i \geq c) * I(y_i = 1)}{\sum_{i=1}^n I(y_i = 1)}
= \frac{1}{|\Gamma|} \sum_{i \in \Gamma} I(x_i \geq c)
\]</span> where <span class="math inline">\(\Gamma = \{i | Y_i = 1\}\)</span>. We can estimate <span class="math inline">\(F\)</span> similarly.</p>
<p>From a data persepctive, the thresholds only jump at observed values of <span class="math inline">\(X\)</span>. So, we can construct the plot as follows:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Add terms at the beginning and the end over the max and under the min</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.concatenate( [[ np.<span class="bu">min</span>(x) <span class="op">-</span> <span class="dv">1</span>], np.sort(np.unique(x)) , [np.<span class="bu">max</span>(x) <span class="op">+</span> <span class="dv">1</span>]])</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>tpr <span class="op">=</span> [np.mean( (x1 <span class="op">&gt;=</span> citer) ) <span class="cf">for</span> citer <span class="kw">in</span> c]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>fpr <span class="op">=</span> [np.mean( (x0 <span class="op">&gt;=</span> citer) ) <span class="cf">for</span> citer <span class="kw">in</span> c]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="validation_files/figure-html/cell-4-output-1.png" width="576" height="416"></p>
</div>
</div>
</section>
<section id="binormal-estimation" class="level3" data-number="20.1.2">
<h3 data-number="20.1.2" class="anchored" data-anchor-id="binormal-estimation"><span class="header-section-number">20.1.2</span> Binormal estimation</h3>
<p>Suppose <span class="math inline">\(X ~|~ Y=y \sim N(\mu_y, \sigma_y^2)\)</span>. Then, note if <span class="math inline">\(\Phi\)</span> is the standard normal distribution function then <span class="math inline">\(T(c) = 1 - \phi\{ (c - \mu_1) / \sigma_1 \}\)</span>, <span class="math inline">\(F(c) = 1 - \phi\{ (c - \mu_0) / \sigma_0 \}\)</span> and <span class="math inline">\(F^{-1}(f) = \mu_0 + \sigma_0 \phi^{-1}(1-f)\)</span>. Thus, the ROC curve is <span class="math display">\[
T\{F^{-1}(f)\} = 1 - \phi\left\{  \frac{\mu_0 + \sigma_0 \phi^{-1}(1-f)}{\sigma_1} \right\}
\]</span> where <span class="math inline">\(\mu_y\)</span> and <span class="math inline">\(\sigma_y\)</span> can be estimated from the data.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>mu0, mu1 <span class="op">=</span> np.mean(x0), np.mean(x1)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>s0, s1 <span class="op">=</span> np.std(x0), np.std(x1)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>c_seq <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1000</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>fpr_binorm <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>norm.cdf(c_seq, mu0, s0)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>tpr_binorm <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>norm.cdf(c_seq, mu1, s1)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr_binorm, tpr_binorm)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="validation_files/figure-html/cell-5-output-1.png" width="576" height="416"></p>
</div>
</div>
</section>
</section>
<section id="testing-versus-training-versions" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="testing-versus-training-versions"><span class="header-section-number">20.2</span> Testing versus training versions</h2>
<p>Traditional statistical</p>
<p><span class="citation" data-cites="begg">(<a href="references.html#ref-begg" role="doc-biblioref"><strong>begg?</strong></a>)</span></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./causal.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Causal DAGs</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ethics.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ethics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>